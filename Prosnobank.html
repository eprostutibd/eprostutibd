<!doctype html>
<html lang="bn">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>eProstutiBD প্রশ্নব্যাংক — সকল প্রস্তুতি হোক গভীর থেকে</title>

  <!-- ✅ SEO -->
  <meta name="description" content="eProstutiBD প্রশ্নব্যাংক — বিষয়ভিত্তিক MCQ, Written এবং Subject Model Test। সকল প্রস্তুতি হোক গভীর থেকে।" />
  <meta name="keywords" content="প্রশ্নব্যাংক, MCQ, Written, Model Test, eProstutiBD, Admission, BCS, IELTS" />
  <meta name="robots" content="index,follow" />
  <meta name="theme-color" content="#1d4ed8" />

  <!-- ✅ Open Graph -->
  <meta property="og:title" content="eProstutiBD প্রশ্নব্যাংক" />
  <meta property="og:description" content="বিষয়ভিত্তিক MCQ, Written এবং Subject Model Test — সকল প্রস্তুতি হোক গভীর থেকে।" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="#" />
  <meta property="og:image" content="#" />

  <!-- ✅ Website structured data -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"WebSite",
    "name":"eProstutiBD প্রশ্নব্যাংক",
    "url":"#",
    "description":"বিষয়ভিত্তিক MCQ, Written এবং Subject Model Test। সকল প্রস্তুতি হোক গভীর থেকে।"
  }
  </script>

  <style>
    :root{
      --bg1:#f7f9ff;
      --bg2:#eef7ff;

      --header1:#1d4ed8;
      --header2:#0ea5e9;

      --card: rgba(255,255,255,.82);
      --line: rgba(18, 28, 55, .10);

      --text:#0f1730;
      --muted:#5a6685;
      --shadow: 0 16px 40px rgba(15,23,48,.12);
      --radius: 18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Noto Sans Bengali", sans-serif;
      color:var(--text);
      background:
        radial-gradient(900px 600px at 10% 10%, rgba(29,78,216,.12), transparent 55%),
        radial-gradient(800px 560px at 92% 14%, rgba(14,165,233,.10), transparent 55%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
      min-height:100vh;
    }
    .app{max-width:1180px;margin:0 auto;padding:12px;}

    /* ===== HEADER (no ugly scroll) ===== */
    header{
      position:sticky; top:0; z-index:30;
      background: linear-gradient(135deg, rgba(29,78,216,.95), rgba(14,165,233,.92));
      border-bottom: 1px solid rgba(255,255,255,.20);
      box-shadow: 0 18px 40px rgba(29,78,216,.20);
    }
    .topbar{
      max-width:1180px;
      margin:0 auto;
      padding:10px 12px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }
    /* ✅ No logo — name acts as logo */
    .brandname{
      color:#fff;
      font-weight: 1000;
      letter-spacing: .3px;
      font-size: 16px;
      line-height: 1;
      white-space: nowrap;
    }
    .tagline{
      color: rgba(255,255,255,.92);
      font-size:12px;
      margin-top:4px;
      white-space:nowrap;
    }
    .brandwrap{display:flex; flex-direction:column; gap:2px; min-width:0}
    .rightwrap{display:flex; align-items:center; gap:10px; flex:0 0 auto}

    /* Desktop nav */
    .navDesktop{
      display:flex;
      gap:8px;
      overflow:auto;
      -webkit-overflow-scrolling: touch;
      scrollbar-width:none;
    }
    .navDesktop::-webkit-scrollbar{display:none}
    .navDesktop a{
      flex:0 0 auto;
      text-decoration:none;
      color:#fff;
      font-size:12px;
      font-weight:800;
      padding:9px 12px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.10);
      white-space:nowrap;
      transition:.15s;
    }
    .navDesktop a:hover{background: rgba(255,255,255,.16)}
    .navDesktop a.active{
      background: rgba(255,255,255,.22);
      border-color: rgba(255,255,255,.28);
    }

    /* ✅ Mobile: menu inside menu bar (dropdown) */
    .menuBtn{
      display:none;
      border: 1px solid rgba(255,255,255,.22);
      background: rgba(255,255,255,.14);
      color:#fff;
      border-radius: 12px;
      padding: 9px 10px;
      font-weight: 900;
      cursor:pointer;
      line-height: 1;
    }
    .mobileMenu{
      display:none;
      max-width:1180px;
      margin: 0 auto;
      padding: 0 12px 12px;
    }
    .mobileMenu .box{
      border: 1px solid rgba(255,255,255,.22);
      background: rgba(255,255,255,.12);
      border-radius: 14px;
      padding: 10px;
      box-shadow: 0 14px 30px rgba(0,0,0,.18);
    }
    .mobileMenu a{
      display:block;
      text-decoration:none;
      color:#fff;
      font-weight:900;
      font-size:12px;
      padding: 10px 10px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      margin-bottom: 8px;
      white-space:nowrap;
    }
    .mobileMenu a:last-child{margin-bottom:0}
    .mobileMenu a.active{
      background: rgba(255,255,255,.18);
      border-color: rgba(255,255,255,.22);
    }

    @media (max-width: 820px){
      .navDesktop{display:none;}
      .menuBtn{display:inline-flex; align-items:center; gap:8px;}
    }

    /* ===== NOTICE ticker (between header and ad) ===== */
    .tickerWrap{
      max-width:1180px;
      margin: 10px auto 0;
      padding: 0 12px;
    }
    .ticker{
      border: 1px solid rgba(18,28,55,.10);
      background: rgba(255,255,255,.75);
      border-radius: 14px;
      overflow:hidden;
      box-shadow: 0 12px 26px rgba(15,23,48,.06);
    }
    .tickerRow{
      display:flex;
      align-items:center;
      gap: 10px;
      padding: 10px 12px;
    }
    .badge{
      flex:0 0 auto;
      font-size:12px;
      font-weight:1000;
      padding: 6px 10px;
      border-radius:999px;
      color:#0f1730;
      background: rgba(14,165,233,.16);
      border: 1px solid rgba(14,165,233,.22);
      white-space:nowrap;
    }
    .marq{
      flex:1;
      overflow:hidden;
      white-space:nowrap;
      color: var(--muted);
      font-size:12px;
    }
    .marq span{
      display:inline-block;
      padding-left: 100%;
      animation: ticker 18s linear infinite;
    }
    @keyframes ticker{
      0%{transform: translateX(0)}
      100%{transform: translateX(-100%)}
    }

    /* ===== Ads ===== */
    .topAdWrap{
      max-width:1180px;
      margin: 10px auto 0;
      padding: 0 12px;
    }
    .ad{
      border: 1px dashed rgba(18,28,55,.22);
      border-radius: 16px;
      padding: 12px;
      background: rgba(255,255,255,.72);
      color: var(--muted);
      font-size: 12px;
      box-shadow: 0 12px 26px rgba(15,23,48,.05);
    }
    .ad .label{
      display:flex; align-items:center; justify-content:space-between;
      gap: 10px;
      margin-bottom: 8px;
    }
    .ad b{color: var(--text)}
    .adbox{
      border: 1px solid rgba(18,28,55,.12);
      border-radius: 14px;
      background: rgba(255,255,255,.60);
      min-height: 140px;
      display:grid;
      place-items:center;
      text-align:center;
      padding: 10px;
    }

    /* ===== layout ===== */
    .grid{
      display:grid;
      grid-template-columns: 1fr 320px;
      gap: 14px;
      padding: 12px 0 0;
    }
    @media (max-width: 980px){
      .grid{grid-template-columns:1fr;}
    }

    .card{
      border:1px solid var(--line);
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .hd{
      padding:14px;
      border-bottom:1px solid var(--line);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }
    .bd{padding:14px}
    .note{font-size:12px;color:var(--muted);line-height:1.6}
    .divider{height:1px;background:var(--line);margin:12px 0}

    /* search */
    .row{display:flex;gap:10px;flex-wrap:wrap}
    .row > *{flex:1}
    .field label{display:block;font-size:12px;color:var(--muted);margin:0 0 6px 2px}
    input{
      width:100%;
      border:1px solid var(--line);
      background: rgba(255,255,255,.78);
      color: var(--text);
      padding: 11px 12px;
      border-radius: 14px;
      outline:none;
      box-shadow: 0 10px 22px rgba(15,23,48,.05);
    }
    input:focus{border-color: rgba(29,78,216,.30)}
    .btn{
      border:1px solid var(--line);
      background: rgba(255,255,255,.85);
      color: var(--text);
      padding: 9px 10px; /* ✅ smaller search button */
      border-radius: 12px;
      cursor:pointer;
      font-weight: 1000;
      white-space:nowrap;
      box-shadow: 0 10px 22px rgba(15,23,48,.05);
      transition:.15s;
      font-size: 12px;
      line-height: 1;
      height: 38px;
      align-self: flex-end;
    }
    .btn:hover{transform: translateY(-1px)}
    .btn:active{transform: translateY(0)}
    .btn.primary{
      border-color: rgba(29,78,216,.18);
      background: rgba(29,78,216,.10);
    }

    /* subjects */
    .subjects{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
    }
    @media (max-width: 980px){
      .subjects{grid-template-columns: repeat(2, 1fr);}
    }
    @media (max-width: 560px){
      .subjects{grid-template-columns: 1fr;}
    }

    .subj{
      border:1px solid var(--line);
      background: rgba(255,255,255,.86);
      border-radius: 18px;
      padding: 14px;
      cursor:pointer;
      transition:.15s;
      box-shadow: 0 12px 26px rgba(15,23,48,.06);
      position:relative;
      overflow:hidden;
    }
    .subj::before{
      content:"";
      position:absolute; inset:-2px;
      background:
        radial-gradient(600px 140px at 15% 0%, rgba(29,78,216,.10), transparent 55%),
        radial-gradient(600px 140px at 100% 0%, rgba(14,165,233,.10), transparent 55%);
      opacity:.9;
      pointer-events:none;
    }
    .subj:hover{transform: translateY(-1px)}
    .subj:active{transform: translateY(0)}
    .subj h3{
      position:relative;
      margin:0;
      font-size: 15px;
      line-height: 1.22;
      letter-spacing:.15px;
      display:-webkit-box;
      -webkit-line-clamp:2;
      -webkit-box-orient:vertical;
      overflow:hidden;
      min-height: 38px;
    }
    .counts{
      position:relative;
      margin-top: 10px;
      display:flex;
      gap:8px;
      flex-wrap:nowrap;
      overflow:hidden;
      white-space:nowrap;
      align-items:center;
    }
    .pill2{
      font-size:12px;
      padding: 7px 10px;
      border-radius: 999px;
      border: 1px solid rgba(18,28,55,.12);
      background: rgba(255,255,255,.74);
      color: var(--muted);
      flex:0 0 auto;
    }
    .pill2 b{color: var(--text)}

    /* inline ad card inside subjects list */
    .adCard{
      border:1px dashed rgba(18,28,55,.24);
      background: rgba(255,255,255,.75);
      border-radius: 18px;
      padding: 14px;
      box-shadow: 0 12px 26px rgba(15,23,48,.05);
      display:grid;
      place-items:center;
      text-align:center;
      min-height: 120px;
    }

    .empty{
      display:none;
      padding: 12px;
      border:1px dashed rgba(18,28,55,.22);
      border-radius: 16px;
      background: rgba(255,255,255,.65);
      color: var(--muted);
      font-size: 12px;
      margin-top: 12px;
    }

    .moreWrap{
      display:flex;
      justify-content:center;
      margin-top: 12px;
    }

    /* sidebar ad */
    .sidebar{
      border:1px solid var(--line);
      background: rgba(255,255,255,.82);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
      height: fit-content;
    }

    /* footer */
    footer{
      margin-top: 14px;
      border-top: 1px solid rgba(18,28,55,.10);
      background: rgba(255,255,255,.70);
      backdrop-filter: blur(14px);
    }
    .foot{
      max-width:1180px;
      margin:0 auto;
      padding: 14px 12px;
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 14px;
      flex-wrap:wrap;
    }
    .fcol{min-width: 180px;}
    .foot a{
      color: var(--muted);
      text-decoration:none;
      font-size:12px;
      display:inline-block;
      padding:4px 0;
    }
    .foot a:hover{color: var(--text)}
    .copy{
      max-width:1180px;
      margin:0 auto;
      padding: 0 12px 14px;
      color: var(--muted);
      font-size: 12px;
      text-align:center;
      white-space:nowrap; /* ✅ one line on mobile too */
      overflow:hidden;
      text-overflow:ellipsis;
    }

    /* skeleton */
    .skeleton{
      border:1px solid var(--line);
      background: rgba(255,255,255,.80);
      border-radius: 18px;
      padding: 14px;
      min-height: 110px;
      box-shadow: 0 12px 26px rgba(15,23,48,.05);
      position: relative;
      overflow:hidden;
    }
    .shimmer{
      position:absolute; inset:0;
      background: linear-gradient(110deg, transparent 0%, rgba(0,0,0,.04) 20%, transparent 40%);
      transform: translateX(-100%);
      animation: sh 1.15s infinite;
    }
    @keyframes sh{to{transform: translateX(100%)}}
  </style>
</head>

<body>
  <header>
    <div class="topbar">
      <div class="brandwrap">
        <div class="brandname">eProstutiBD</div>
        <div class="tagline">সকল প্রস্তুতি হোক গভীর থেকে</div>
      </div>

      <div class="rightwrap">
        <button class="menuBtn" id="menuBtn" aria-expanded="false" aria-controls="mobileMenu" onclick="toggleMenu()">
          ☰ মেনু
        </button>
      </div>

      <!-- Desktop nav stays in header but smooth -->
      <nav class="navDesktop" aria-label="Main navigation">
        <a class="active" href="#">একাডেমী</a>
        <a href="#">প্রশ্ন ব্যাঙ্ক</a>
        <a href="#">এডমিশন অ্যাসিস্ট্যান্ট</a>
        <a href="#">জব অ্যাসিস্ট্যান্ট</a>
        <a href="#">মডেল টেস্ট</a>
        <a href="#">কারেন্ট এফেয়ার্স</a>
        <a href="#">IELTS</a>
        <a href="#">BCS</a>
        <a href="#">নোটিশ</a>
        <a href="#">ব্লগ</a>
        <a href="#">ক্যারিয়ার</a>
      </nav>
    </div>

    <!-- Mobile menu box -->
    <div class="mobileMenu" id="mobileMenu">
      <div class="box">
        <a class="active" href="#">একাডেমী</a>
        <a href="#">প্রশ্ন ব্যাঙ্ক</a>
        <a href="#">এডমিশন অ্যাসিস্ট্যান্ট</a>
        <a href="#">জব অ্যাসিস্ট্যান্ট</a>
        <a href="#">মডেল টেস্ট</a>
        <a href="#">কারেন্ট এফেয়ার্স</a>
        <a href="#">IELTS</a>
        <a href="#">BCS</a>
        <a href="#">নোটিশ</a>
        <a href="#">ব্লগ</a>
        <a href="#">ক্যারিয়ার</a>
      </div>
    </div>
  </header>

  <!-- ✅ Notice ticker (between header and ad) -->
  <div class="tickerWrap">
    <div class="ticker" role="region" aria-label="Notice">
      <div class="tickerRow">
        <span class="badge">নোটিশ</span>
        <div class="marq">
          <!-- ✅ তুমি পরে এই টেক্সট বদলাতে পারবে -->
          <span>আজকের আপডেট: নতুন Subject যুক্ত হয়েছে • নতুন Model Test যুক্ত হয়েছে • নিয়মিত পড়াশোনা করুন • সকল প্রস্তুতি হোক গভীর থেকে</span>
        </div>
      </div>
    </div>
  </div>

  <!-- ✅ Top ad under notice -->
  <div class="topAdWrap">
    <div class="ad">
      <div class="label">
        <b>Ad Slot</b>
        <span>Header নিচে • Responsive</span>
      </div>
      <div class="adbox">
        <!-- ✅ এখানে তোমার Adsense/Adstra কোড বসাবে -->
        <div>
          <div style="font-weight:1000; color:var(--text); margin-bottom:6px;">Responsive Ad</div>
          <div class="note">Paste ad code here</div>
        </div>
      </div>
    </div>
  </div>

  <main class="app">
    <div class="grid">
      <!-- Main -->
      <section class="card">
        <div class="hd">
          <b>Subjects</b>
          <span class="note" id="countHint">Loading…</span>
        </div>

        <div class="bd">
          <div class="row">
            <div class="field">
              <label>Search Subject</label>
              <input id="search" placeholder="যেমন: গণিত / Physics / Biology" oninput="onSearch()" />
            </div>
            <button class="btn" onclick="onSearch()">Search</button>
          </div>

          <div class="divider"></div>

          <div id="subjects" class="subjects" aria-live="polite"></div>
          <div id="empty" class="empty">কোনো Subject পাওয়া যায়নি।</div>

          <div class="moreWrap">
            <button id="btnMore" class="btn primary" style="display:none" onclick="loadMore()">More Subject</button>
          </div>
        </div>
      </section>

      <!-- ✅ Sidebar ad option -->
      <aside class="sidebar">
        <div class="hd">
          <b>Sponsored</b>
          <span class="note">Ads</span>
        </div>
        <div class="bd">
          <div class="ad">
            <div class="label">
              <b>Ad Slot</b>
              <span>Sidebar • 300x250</span>
            </div>
            <div class="adbox" style="min-height: 280px">
              <!-- ✅ এখানে তোমার Adsense/Adstra কোড বসাবে -->
              <div>
                <div style="font-weight:1000; color:var(--text); margin-bottom:6px;">Sidebar Ad</div>
                <div class="note">Paste ad code here</div>
              </div>
            </div>
          </div>

          <div class="divider"></div>

          <div class="ad">
            <div class="label">
              <b>Ad Slot</b>
              <span>Bottom • Responsive</span>
            </div>
            <div class="adbox" style="min-height: 210px">
              <!-- ✅ এখানে তোমার Adsense/Adstra কোড বসাবে -->
              <div>
                <div style="font-weight:1000; color:var(--text); margin-bottom:6px;">Bottom Ad</div>
                <div class="note">Paste ad code here</div>
              </div>
            </div>
          </div>
        </div>
      </aside>
    </div>
  </main>

  <footer>
    <div class="foot">
      <div class="fcol">
        <b>দরকারি পেজ</b><br/>
        <a href="#">About</a><br/>
        <a href="#">Privacy Policy</a><br/>
        <a href="#">Terms</a><br/>
        <a href="#">Contact</a><br/>
      </div>

      <div class="fcol">
        <b>অন্যান্য</b><br/>
        <a href="#">Notice</a><br/>
        <a href="#">Blog</a><br/>
        <a href="#">Career</a><br/>
        <a href="#">Help</a><br/>
      </div>
    </div>

    <!-- ✅ Mobile footer one line -->
    <div class="copy">© 2026 eProstutiBD All rights reserved</div>
  </footer>

  <!-- Firebase compat (visitor: no auth) -->
  <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore-compat.js"></script>

  <script>
    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyBUBwLuNDSJF1xrkUVTTOXs76f_o4YkBiI",
      authDomain: "eprostutibd-webapp.firebaseapp.com",
      projectId: "eprostutibd-webapp",
      storageBucket: "eprostutibd-webapp.firebasestorage.app",
      messagingSenderId: "1044069942330",
      appId: "1:1044069942330:web:b3fc6c8b75d7b80686a103",
      measurementId: "G-T2G55NMDQT"
    };

    const COL_SUBJECTS = "subjects";
    const COL_SUBJECT_MODEL_TESTS = "subject_model_tests";

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const $ = (id)=>document.getElementById(id);

    function esc(str){
      return String(str).replace(/[&<>"']/g, (m)=>({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;" }[m]));
    }

    // data
    let SUBJECTS = [];
    const modelTestCountMap = new Map();
    const modelTestUnsubs = new Map();

    // paging + search
    const PAGE_SIZE = 6;
    let visibleCount = 6;
    let currentQuery = "";

    // ===== mobile menu
    function toggleMenu(){
      const box = $("mobileMenu");
      const btn = $("menuBtn");
      const open = box.style.display === "block";
      box.style.display = open ? "none" : "block";
      btn.setAttribute("aria-expanded", open ? "false" : "true");
    }
    window.toggleMenu = toggleMenu;

    // ===== related search (not only 100% match)
    function normalize(s){
      return String(s||"")
        .toLowerCase()
        .replace(/[^\p{L}\p{N}\s]+/gu, " ")
        .replace(/\s+/g, " ")
        .trim();
    }
    function tokens(s){
      const t = normalize(s);
      return t ? t.split(" ").filter(Boolean) : [];
    }
    function relatedScore(query, name){
      const q = normalize(query);
      const n = normalize(name);
      if(!q) return 1;
      if(n.includes(q)) return 100; // strong
      const qt = tokens(q);
      const nt = new Set(tokens(n));
      if(!qt.length) return 1;
      let hit = 0;
      qt.forEach(w=>{ if(nt.has(w)) hit++; });
      let partial = 0;
      qt.forEach(w=>{
        if(w.length >= 3){
          for(const tw of nt){
            if(tw.startsWith(w) || w.startsWith(tw)){ partial += 0.35; break; }
          }
        }
      });
      return (hit/qt.length)*10 + partial;
    }

    function syncModelTestListeners(){
      const alive = new Set(SUBJECTS.map(s=>s.id));

      for(const [sid, unsub] of modelTestUnsubs.entries()){
        if(!alive.has(sid)){
          try{ unsub(); }catch(e){}
          modelTestUnsubs.delete(sid);
          modelTestCountMap.delete(sid);
        }
      }

      SUBJECTS.forEach(s=>{
        if(modelTestUnsubs.has(s.id)) return;

        const unsub = db.collection(COL_SUBJECT_MODEL_TESTS)
          .where("subjectId","==", s.id)
          .onSnapshot((snap)=>{
            modelTestCountMap.set(s.id, snap.size || 0);
            renderSubjects();
          }, (err)=>{
            console.error(err);
            modelTestCountMap.set(s.id, modelTestCountMap.get(s.id) || 0);
          });

        modelTestUnsubs.set(s.id, unsub);
      });
    }

    function openDetails(subjectId){
      const url = `details-prosnobank.html?subjectId=${encodeURIComponent(subjectId)}`;
      window.open(url, "_blank", "noopener");
    }

    function renderSkeleton(){
      const wrap = $("subjects");
      wrap.innerHTML = "";
      for(let i=0;i<6;i++){
        const d = document.createElement("div");
        d.className = "skeleton";
        d.innerHTML = `<div class="shimmer"></div>`;
        wrap.appendChild(d);
      }
      $("empty").style.display = "none";
      $("btnMore").style.display = "none";
    }

    function onSearch(){
      currentQuery = ($("search").value || "").trim();
      visibleCount = PAGE_SIZE;
      renderSubjects();
    }
    window.onSearch = onSearch;

    function loadMore(){
      visibleCount += PAGE_SIZE;
      renderSubjects();
    }
    window.loadMore = loadMore;

    // ✅ insert ad after every 5 subject cards
    function makeInlineAdCard(index){
      const ad = document.createElement("div");
      ad.className = "adCard";
      ad.setAttribute("aria-label", "Ad slot");
      ad.innerHTML = `
        <div>
          <div style="font-weight:1000; color:var(--text); margin-bottom:6px;">Ad Slot</div>
          <div class="note">Paste AdSense/Adstra code here (inline after 5 cards)</div>
        </div>
      `;
      return ad;
    }

    function renderSubjects(){
      const q = currentQuery;

      const scored = SUBJECTS
        .map(s => ({...s, __score: relatedScore(q, s.name || "")}))
        .filter(s => !q ? true : (s.__score >= 1.2))
        .sort((a,b)=>{
          // highest score first, then name
          if(b.__score !== a.__score) return b.__score - a.__score;
          return (a.name||"").localeCompare(b.name||"");
        });

      const total = scored.length;
      const shownItems = scored.slice(0, visibleCount);

      $("countHint").textContent = `Total: ${total}`;

      const wrap = $("subjects");
      wrap.innerHTML = "";

      if(!total){
        $("empty").style.display = "block";
        $("btnMore").style.display = "none";
        return;
      }
      $("empty").style.display = "none";

      let cardCount = 0;
      shownItems.forEach((s)=>{
        cardCount++;

        const mcq = s.counts?.mcq || 0;
        const written = s.counts?.written || 0;
        const mtCount = modelTestCountMap.get(s.id) ?? 0;

        const el = document.createElement("article");
        el.className = "subj";
        el.setAttribute("role","button");
        el.setAttribute("tabindex","0");
        el.setAttribute("aria-label", (s.name||"Subject") + " খুলুন");
        el.onclick = ()=>openDetails(s.id);
        el.onkeydown = (e)=>{ if(e.key==="Enter"||e.key===" "){ e.preventDefault(); openDetails(s.id);} };

        el.innerHTML = `
          <h3 title="${esc(s.name||"")}">${esc(s.name||"(no name)")}</h3>
          <div class="counts" aria-label="Counts">
            <span class="pill2">MCQ <b>${mcq}</b></span>
            <span class="pill2">Written <b>${written}</b></span>
            <span class="pill2">Model <b>${mtCount}</b></span>
          </div>
        `;
        wrap.appendChild(el);

        // ✅ after every 5 cards, insert an inline ad card (if more content remains)
        if(cardCount % 5 === 0 && cardCount < shownItems.length){
          wrap.appendChild(makeInlineAdCard(cardCount/5));
        }
      });

      $("btnMore").style.display = (total > shownItems.length) ? "inline-flex" : "none";
    }

    // start
    renderSkeleton();

    db.collection(COL_SUBJECTS).onSnapshot((snap)=>{
      SUBJECTS = snap.docs.map(d => ({ id:d.id, ...d.data() }));
      syncModelTestListeners();
      renderSubjects();
    }, (err)=>{
      console.error(err);
      $("countHint").textContent = "Failed to load (check Firestore rules)";
      $("subjects").innerHTML = "";
      $("empty").style.display = "block";
      $("btnMore").style.display = "none";
    });
  </script>
</body>
</html>
