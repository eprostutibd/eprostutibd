<!doctype html>
<html lang="bn">
<head>
<meta charset="utf-8">
<title>Start Model Test | eProstutiBD</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Bengali:wght@400;700;900&display=swap" rel="stylesheet">

<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

<style>
body{
  margin:0;
  font-family:"Noto Sans Bengali",system-ui;
  background:#f5f7fb;
  color:#0f172a;
}
.container{max-width:980px;margin:auto;padding:14px}
.card{
  background:#fff;
  border-radius:18px;
  padding:16px;
  box-shadow:0 14px 30px rgba(0,0,0,.08);
}
.title{font-size:18px;font-weight:900;text-align:center}
.sub{text-align:center;color:#64748b;font-size:13px}

.btn{
  border:none;
  padding:10px 16px;
  border-radius:999px;
  font-weight:900;
  cursor:pointer;
}
.btnPrimary{background:#2563eb;color:#fff}
.btnDanger{background:#dc2626;color:#fff}

/* ===== Question ===== */
.qRow{border-bottom:1px solid #e5e7eb;padding:14px 0}
.qHead{display:flex;gap:10px}
.qNo{
  font-size:12px;
  font-weight:900;
  padding:6px 10px;
  border-radius:999px;
  border:1px solid #c7d2fe;
}
.opts{
  margin-top:10px;
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:8px 14px;
}
.opt{
  display:grid;
  grid-template-columns:20px 1fr;
  gap:8px;
  cursor:pointer;
}
.opt span{font-size:13px}

/* ===== Details Sheet ===== */
#detailsSheet{display:none;margin-top:20px}
.dsStats{
  display:flex;gap:8px;flex-wrap:wrap;justify-content:center;margin-top:10px
}
.dsBadge{
  padding:6px 12px;
  border-radius:999px;
  font-size:12px;
  font-weight:900;
  border:1px solid #cbd5f5;
}
.dsBadge.ok{color:#16a34a}
.dsBadge.bad{color:#dc2626}
.dsBadge.warn{color:#f59e0b}

.dsQ{border-bottom:1px solid #e5e7eb;padding:14px 0}
.dsOpts{
  margin-top:10px;
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:6px 14px;
}
.dsOpt{
  display:grid;
  grid-template-columns:20px 20px 1fr;
  gap:6px;
  font-size:13px;
}
.dsIcon{
  width:20px;height:20px;
  border-radius:999px;
  display:grid;place-items:center;
  border:1px solid #cbd5f5;
}
.dsIcon.ok{color:#16a34a}
.dsIcon.bad{color:#dc2626}
.dsNoAns{color:#dc2626;font-weight:900;margin-top:6px}

/* ===== PDF ===== */
.pdfArea{
  position:fixed;
  left:-9999px;
  top:0;
  width:794px;
  background:#fff;
  padding:16px;
}
.pdfFrame{
  border:2px solid #000;
  padding:16px;
  min-height:1050px;
  position:relative;
}
.pdfWatermark{
  position:absolute;inset:0;
  display:grid;place-items:center;
}
.pdfWatermark span{
  font-size:80px;
  font-weight:900;
  opacity:.08;
  transform:rotate(-25deg);
}
</style>
</head>

<body>
<div class="container">

<div class="card" id="testCard">
  <h2 class="title">Rajshahi School Model Test 1</h2>
  <p class="sub">নাম ও জেলা দিয়ে টেস্ট শুরু করুন</p>

  <input id="studentName" placeholder="নাম" style="width:100%;padding:10px;margin-top:10px">
  <input id="studentDistrict" placeholder="জেলা" style="width:100%;padding:10px;margin-top:8px">

  <button class="btn btnPrimary" style="margin-top:12px" onclick="startTest()">Start</button>

  <div id="questionArea"></div>

  <div style="text-align:center;margin-top:16px">
    <button class="btn btnDanger" onclick="submitTest()">Submit</button>
  </div>
</div>

<section id="detailsSheet">
  <div class="card">
    <h2 class="title" id="dsTitle"></h2>
    <p class="sub" id="dsSub"></p>

    <div class="dsStats" id="dsStats"></div>

    <div style="text-align:center;margin-top:12px">
      <button class="btn btnPrimary" onclick="downloadResultPDF()">PDF Download</button>
    </div>

    <div id="dsQuestions"></div>
  </div>
</section>

<div class="pdfArea" id="pdfArea"></div>

</div>

<script>
const questions=[
 {id:"q1",question:"One of the students ___ absent",options:["are","were","is","have"],correctIndex:2},
 {id:"q2",question:"Synonym of Obsolete",options:["Modern","Outdated","New","Recent"],correctIndex:1}
];

const answers={};
let studentName="",studentDistrict="";

function startTest(){
  studentName=document.getElementById("studentName").value;
  studentDistrict=document.getElementById("studentDistrict").value;
  if(!studentName||!studentDistrict){alert("নাম ও জেলা দিন");return;}
  renderQuestions();
}

function renderQuestions(){
  const a=document.getElementById("questionArea");
  a.innerHTML="";
  questions.forEach((q,i)=>{
    let h=`<div class="qRow">
      <div class="qHead"><span class="qNo">Q${i+1}</span>${q.question}</div>
      <div class="opts">`;
    q.options.forEach((op,oi)=>{
      h+=`<div class="opt" onclick="answers['${q.id}']=${oi}">
        <span>○</span><span>${op}</span></div>`;
    });
    h+=`</div></div>`;
    a.insertAdjacentHTML("beforeend",h);
  });
}

function submitTest(){
  const payload={
    studentName,studentDistrict,
    submittedAt:Date.now(),
    modelTestName:"Rajshahi School Model Test 1",
    answers:{mcq:answers},
    result:{totalQuestion:questions.length,right:0,wrong:0}
  };
  questions.forEach(q=>{
    const c=q.correctIndex;
    const ch=answers[q.id];
    if(ch===undefined)return;
    if(ch===c)payload.result.right++;
    else payload.result.wrong++;
  });
  renderDetails(payload);
}

function renderDetails(p){
  document.getElementById("detailsSheet").style.display="block";
  document.getElementById("testCard").style.display="none";

  document.getElementById("dsTitle").textContent=
    `${p.modelTestName} — Details Sheet`;

  document.getElementById("dsSub").textContent=
    `${p.studentName} (${p.studentDistrict}) • Submitted: ${new Date(p.submittedAt).toLocaleString("bn-BD")}`;

  const na=p.result.totalQuestion-(p.result.right+p.result.wrong);
  document.getElementById("dsStats").innerHTML=
    `<span class="dsBadge">${p.result.totalQuestion} Q</span>
     <span class="dsBadge ok">✓ ${p.result.right} Right</span>
     <span class="dsBadge bad">✗ ${p.result.wrong} Wrong</span>
     <span class="dsBadge warn">${na} No Ans</span>`;

  const wrap=document.getElementById("dsQuestions");
  wrap.innerHTML="";
  const L=["A","B","C","D"];
  questions.forEach((q,i)=>{
    let h=`<div class="dsQ"><b>Q${i+1}.</b> ${q.question}<div class="dsOpts">`;
    q.options.forEach((op,oi)=>{
      let icon="",cls="";
      if(oi===q.correctIndex){icon="✓";cls="ok";}
      if(answers[q.id]===oi && oi!==q.correctIndex){icon="✗";cls="bad";}
      h+=`<div class="dsOpt"><span class="dsIcon ${cls}">${icon}</span><span>${L[oi]}.</span><span>${op}</span></div>`;
    });
    h+=`</div>`;
    if(answers[q.id]===undefined)h+=`<div class="dsNoAns">আপনি কোনো উত্তর সিলেক্ট করেননি।</div>`;
    h+=`</div>`;
    wrap.insertAdjacentHTML("beforeend",h);
  });
}

async function downloadResultPDF(){
  const area=document.getElementById("pdfArea");
  area.innerHTML=
    `<div class="pdfFrame">
      <div class="pdfWatermark"><span>eProstutiBD</span></div>
      ${document.getElementById("detailsSheet").innerHTML}
    </div>`;
  const canvas=await html2canvas(area,{scale:2});
  const img=canvas.toDataURL("image/jpeg",0.95);
  const {jsPDF}=window.jspdf;
  const pdf=new jsPDF("p","pt","a4");
  pdf.addImage(img,"JPEG",0,0,
    pdf.internal.pageSize.getWidth(),
    pdf.internal.pageSize.getHeight());
  pdf.save("result-details.pdf");
}
</script>
</body>
</html>
